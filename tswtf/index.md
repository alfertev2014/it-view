# TypeScript, WTF?

## Предисловие

Всем привет!
Меня зовут Василий Алфертьев. Я в последнее время front-end разработчик. В своё время успел пройти через C++, системное программирование, Java и прочие докеры, микросервисы... С самого универа увлекаюсь языками программирования, компиляторами и математическими основами, которые за ними стоят. Фанат систем типов. И в последнее время я сосредоточился на UI-фреймворках в вебе, как они устроены и что пытаются сделать, чтобы быть "удобными". За всю карьеру успел насмотреться всякого, и накопил наблюдения и мысли, которыми хочется поделиться.

В этом выступлении я хочу обратить внимание на систему типов TypeScript. Некоторые моменты давно всем очевидны. Те, у кого побольше опыта, ничему не удивятся из того, что я сейчас расскажу. Но никто из нас не становился сразу опытным. Я тоже был когда-то наивным и имел неоправданные ожидания от технологий, и лишь со временем открывал для себя нюансы, с которыми нужно быть внимательнее.

## Soundness

Итак, TypeScript - это язык программирования, который транспилируется в JavaScript, расширяя синтаксис типами. Когда я с ним только познакомился, это было ещё до версии 2.0. Но с выходом 2.0 и добавлением флагов strict я проникся мощью системы типов, которая с каждой версией всё крепчала. При своей простоте, она богатая, гибкая, выразительная... Но дырявая. Есть много мест, где типизация нарушается. Где-то это происходит по желанию самого разработчика, а где-то связано с бесшовной интеграцией с JavaScript, который динамически типизирован и имеет столько магии и допускает такие приёмы программирования, которые просто тяжело или невозможно типизировать.

Всё это следствие того, что TypeScript, несмотря на своё название, ставит перед собой другие цели. Обеспечение строгой корректности не является целью. Система типов ослаблена в таких местах, чтобы можно было продолжать писать в привычном стиле, как на JavaScript, а также, постепенно добавлять типы в существующий код на JavaScript без его существенного переписывания.

То есть TypeScript - это просто "штука", которая стоит сбоку от JavaScirpt.

Окей, это очевидные моменты. Допустим, мы постараемся всего вот этого избежать и захотим выделить в нашей кодовой базе исходники, в которых будет "более строгий TypeScript", а все вот эти потенциально опасные вещи постараемся изолировать, чтобы пристальнее следить, тщательнее тестировать. А если у нас где-то завёлся баг из-за несоответствия типов, то искать будем его там, а не по всей кодовой базе.

И вот в этих условиях я подумал: "Хочу писать на TypeScript, как на OCaml-е". Ну и что, что нет pattern-matching-а, tagged unions и даже номинальные типы можно реализовать. Но оказалось, что TypeScript имеет больше сюрпризов, чем я думал.